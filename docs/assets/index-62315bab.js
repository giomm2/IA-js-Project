import{CreateWebWorkerMLCEngine as g,MLCEngine as y,WebWorkerMLCEngineHandler as b}from"https://esm.run/@mlc-ai/web-llm";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const s of t.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function c(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(e){if(e.ep)return;e.ep=!0;const t=c(e);fetch(e.href,t)}})();const h="Phi-3-mini-4k-instruct-q4f16_1-MLC",L=document.querySelector("form"),d=document.querySelector("input"),$=document.querySelector("#message-template"),q=document.querySelector("ul"),i=document.querySelector("main"),l=document.querySelector("button"),C=document.querySelector("small");let a=[];const S=await g(new Worker("/worker.js",{type:"module"}),h,{initProgressCallback:n=>{C.textContent=`${n.text}`,n.progress===1&&l.removeAttribute("disabled")}});L.addEventListener("submit",async n=>{var s;n.preventDefault();const o=d.value.trim();o!==""&&(d.value=""),m(o,"user"),l.setAttribute("disabled",!0);const c={role:"user",content:o};a.push(c);const r=await S.chat.completions.create({messages:a,stream:!0});let e="";const t=m("","bot");for await(const f of r){const u=f.choices[0],p=((s=u==null?void 0:u.delta)==null?void 0:s.content)??"";e+=p,t.textContent=e}l.removeAttribute("disabled"),a.push({role:"assistant",content:e}),i.scrollTop=i.scrollHeight});function m(n,o){const r=$.content.cloneNode(!0).querySelector(".message"),e=r.querySelector("span"),t=r.querySelector("p");return t.textContent=n,e.textContent=o==="bot"?"IA":"You",r.classList.add(o),q.appendChild(r),l.setAttribute("disabled",!0),i.scrollTop=i.scrollHeight,t}const w=new y,M=new b(w);onmessage=n=>{M.onmessage(n)};
